# SUMO Login - ZK ç™»å½•æ¼”ç¤º

ä¸€ä¸ªåŸºäºé›¶çŸ¥è¯†è¯æ˜ï¼ˆZero-Knowledge Proofï¼‰çš„ Google ç™»å½•æ¼”ç¤ºåº”ç”¨ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ ZK æŠ€æœ¯å®ç°æ— éœ€æš´éœ²ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„èº«ä»½éªŒè¯ã€‚

## ğŸ¯ ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜ï¼Ÿ

**é›¶çŸ¥è¯†è¯æ˜**ï¼ˆZero-Knowledge Proof, ZKPï¼‰æ˜¯ä¸€ç§å¯†ç å­¦æŠ€æœ¯ï¼Œå…è®¸ä¸€æ–¹ï¼ˆè¯æ˜è€…ï¼‰å‘å¦ä¸€æ–¹ï¼ˆéªŒè¯è€…ï¼‰è¯æ˜æŸä¸ªé™ˆè¿°æ˜¯çœŸå®çš„ï¼Œè€Œæ— éœ€é€éœ²ä»»ä½•è¶…å‡ºé™ˆè¿°æœ¬èº«çœŸå®æ€§çš„ä¿¡æ¯ã€‚

### ç”Ÿæ´»ä¸­çš„ç±»æ¯”

æƒ³è±¡ä½ è¦è¯æ˜ä½ çŸ¥é“ä¸€ä¸ªä¿é™©ç®±çš„å¯†ç ï¼Œä½†ä¸æƒ³å‘Šè¯‰å¯¹æ–¹å¯†ç æ˜¯ä»€ä¹ˆï¼š

1. **ä¼ ç»Ÿæ–¹å¼**ï¼šä½ ç›´æ¥å‘Šè¯‰å¯¹æ–¹å¯†ç  â†’ å¯†ç æ³„éœ²é£é™©
2. **ZK æ–¹å¼**ï¼šä½ æ‰“å¼€ä¿é™©ç®±å–å‡ºé‡Œé¢çš„ç‰©å“ç»™å¯¹æ–¹çœ‹ â†’ è¯æ˜ä½ çŸ¥é“å¯†ç ï¼Œä½†å¯†ç æœ¬èº«ä»æœªæš´éœ²

åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬è¯æ˜"ç”¨æˆ·æ‹¥æœ‰æœ‰æ•ˆçš„ Google è´¦å·"ï¼Œä½†ä¸éœ€è¦æš´éœ²ç”¨æˆ·çš„é‚®ç®±ã€JWT ä»¤ç‰Œç­‰æ•æ„Ÿä¿¡æ¯ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Google OAuth ç™»å½•                                       â”‚
â”‚     - ç”¨æˆ·ä½¿ç”¨ Google è´¦å·ç™»å½•                              â”‚
â”‚     - è·å– Google ç”¨æˆ·ä¿¡æ¯ï¼ˆé‚®ç®±ã€sub ID ç­‰ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ç”Ÿæˆä¼šè¯å¯†é’¥                                            â”‚
â”‚     - åˆ›å»ºä¸´æ—¶å¯†é’¥å¯¹ï¼ˆå…¬é’¥ + ç§é’¥ï¼‰                         â”‚
â”‚     - 24 å°æ—¶åè‡ªåŠ¨è¿‡æœŸ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ZK è¯æ˜ç”Ÿæˆ                                             â”‚
â”‚     - ä» JWT æ´¾ç”Ÿç§˜å¯†å€¼                                     â”‚
â”‚     - è®¡ç®—èº«ä»½æ‰¿è¯ºï¼ˆIdentity Commitmentï¼‰                   â”‚
â”‚     - ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. éªŒè¯ä¸è´¦æˆ·åˆ›å»º                                          â”‚
â”‚     - éªŒè¯ ZK è¯æ˜çš„æœ‰æ•ˆæ€§                                  â”‚
â”‚     - åˆ›å»ºæ™ºèƒ½è´¦æˆ·                                          â”‚
â”‚     - ç”¨æˆ·è·å¾—åŒºå—é“¾åœ°å€                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” æ ¸å¿ƒæµç¨‹è¯¦è§£

### æ­¥éª¤ 1: ç§˜å¯†æ´¾ç”Ÿï¼ˆSecret Derivationï¼‰

```
JWT Token â†’ SHA-256 å“ˆå¸Œ â†’ å–å‰ 32 å­—èŠ‚ â†’ Secret
```

**ä¸ºä»€ä¹ˆéœ€è¦ç§˜å¯†ï¼Ÿ**
- ç§˜å¯†æ˜¯ä»ç”¨æˆ·çš„ JWT æ´¾ç”Ÿçš„å”¯ä¸€å€¼
- åªæœ‰æ‹¥æœ‰æœ‰æ•ˆ JWT çš„ç”¨æˆ·æ‰èƒ½è®¡ç®—å‡ºæ­£ç¡®çš„ç§˜å¯†
- ç§˜å¯†ä¸ä¼šåœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œåªç”¨äºæœ¬åœ°è®¡ç®—

### æ­¥éª¤ 2: Email å“ˆå¸Œï¼ˆEmail Hashingï¼‰

ç”±äº Poseidon å“ˆå¸Œå‡½æ•°æœ€å¤šæ”¯æŒ 16 ä¸ªè¾“å…¥ï¼Œæˆ‘ä»¬éœ€è¦å°† email åˆ†æ‰¹å¤„ç†ï¼š

```
Email: "user@example.com" (32 bytes)

Chunk 1: [0, byte0-byte14]  â†’ Hash 1
Chunk 2: [Hash 1, byte15-byte29] â†’ Hash 2
Chunk 3: [Hash 2, byte30-byte31, 0, ...] â†’ Email Hash
```

**ä¸ºä»€ä¹ˆæ˜¯é“¾å¼å“ˆå¸Œï¼Ÿ**
- æ¯è½®å¤„ç† 15 ä¸ªæ•°æ®å­—èŠ‚ + 1 ä¸ªé“¾å¼è¾“å…¥
- ç¬¬ä¸€è½®çš„é“¾å¼è¾“å…¥ä¸º 0
- åç»­è½®æ¬¡ä½¿ç”¨å‰ä¸€è½®çš„å“ˆå¸Œç»“æœä½œä¸ºé“¾å¼è¾“å…¥
- æœ€ç»ˆè¾“å‡ºå°±æ˜¯ Email Hash

sncast declare \                                                                                                              
    --contract-name Groth16VerifierBN254 \                                                                                 
    --account=new_account
sncast --account=new_account deploy \
                  --class-hash=<NEW_LOGIN_CLASS_HASH> \
                  --constructor-calldata 0x<ACCOUNT_CLASS_HASH> 0x75edb4789d214a899c95bb756bbdcc343481dcaafdafcfaf4f0409ad1548f5b \
                  --network=sepolia

                  

### æ­¥éª¤ 3: èº«ä»½æ‰¿è¯ºï¼ˆIdentity Commitmentï¼‰

```
Identity Commitment = Poseidon(Email Hash, Sub, Secret)
```

**ä»€ä¹ˆæ˜¯èº«ä»½æ‰¿è¯ºï¼Ÿ**

èº«ä»½æ‰¿è¯ºï¼ˆIdentity Commitmentï¼‰æ˜¯ä¸€ä¸ªå¯†ç å­¦æ¦‚å¿µï¼Œç±»ä¼¼äº"æ•°å­—æŒ‡çº¹"æˆ–"èº«ä»½å“ˆå¸Œ"ã€‚å®ƒæ˜¯ç”¨æˆ·èº«ä»½çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä½†å…·æœ‰ä»¥ä¸‹ç‰¹æ®Šæ€§è´¨ï¼š

1. **å”¯ä¸€æ€§**ï¼šæ¯ä¸ªç”¨æˆ·çš„èº«ä»½æ‰¿è¯ºéƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„
2. **ç¡®å®šæ€§**ï¼šç›¸åŒçš„è¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„æ‰¿è¯º
3. **å•å‘æ€§**ï¼šæ— æ³•ä»æ‰¿è¯ºåæ¨åŸå§‹è¾“å…¥
4. **ç»‘å®šæ€§**ï¼šæ‰¿è¯ºä¸ç‰¹å®šèº«ä»½æ°¸ä¹…ç»‘å®š

**ç±»æ¯”ç†è§£ï¼š**

æƒ³è±¡ä½ åœ¨ä¸€ä¸ªåŒ¿åä¿±ä¹éƒ¨æ³¨å†Œï¼š
- **ä¼ ç»Ÿæ–¹å¼**ï¼šä½ éœ€è¦å‡ºç¤ºèº«ä»½è¯ï¼ˆæš´éœ²çœŸå®èº«ä»½ï¼‰
- **èº«ä»½æ‰¿è¯ºæ–¹å¼**ï¼šä½ æä¾›ä¸€ä¸ª"ä¼šå‘˜ç¼–å·"ï¼Œä¿±ä¹éƒ¨å¯ä»¥éªŒè¯è¿™ä¸ªç¼–å·å±äºä½ ï¼Œä½†ä¸çŸ¥é“ä½ çš„çœŸå®èº«ä»½

**åœ¨ SUMO ä¸­çš„ç»„æˆï¼š**

èº«ä»½æ‰¿è¯ºç”±ä¸‰ä¸ªè¦ç´ é€šè¿‡ Poseidon å“ˆå¸Œè®¡ç®—å¾—å‡ºï¼š

| è¦ç´  | è¯´æ˜ | æ¥æº |
|------|------|------|
| **Email Hash** | ç”¨æˆ·é‚®ç®±çš„å“ˆå¸Œå€¼ | ä» JWT ä¸­çš„ email å­—æ®µè®¡ç®— |
| **Sub** | Google ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ | JWT ä¸­çš„ sub å­—æ®µ |
| **Secret** | ä» JWT æ´¾ç”Ÿçš„ç§˜å¯†å€¼ | JWT çš„ SHA-256 å“ˆå¸Œ |

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸‰ä¸ªè¦ç´ ï¼Ÿ**

1. **Email Hash**ï¼šç¡®ä¿é‚®ç®±çš„å”¯ä¸€æ€§
2. **Sub**ï¼šGoogle åˆ†é…çš„å…¨å±€å”¯ä¸€ç”¨æˆ· ID
3. **Secret**ï¼šè¯æ˜ç”¨æˆ·æ‹¥æœ‰æœ‰æ•ˆçš„ JWTï¼ˆåªæœ‰æŒæœ‰ JWT æ‰èƒ½è®¡ç®—å‡ºæ­£ç¡®çš„ Secretï¼‰

**å®‰å…¨ç‰¹æ€§ï¼š**

- **éšç§ä¿æŠ¤**ï¼šéªŒè¯è€…åªèƒ½çœ‹åˆ°æ‰¿è¯ºå€¼ï¼Œæ— æ³•çŸ¥é“ç”¨æˆ·çš„é‚®ç®±æˆ– Google ID
- **ä¸å¯ä¼ªé€ **ï¼šä¸çŸ¥é“ Secret çš„äººæ— æ³•ç”Ÿæˆæœ‰æ•ˆçš„æ‰¿è¯º
- **å¯éªŒè¯**ï¼šæŒæœ‰ JWT çš„ç”¨æˆ·å¯ä»¥éšæ—¶é‡æ–°è®¡ç®—ç›¸åŒçš„æ‰¿è¯ºæ¥è¯æ˜èº«ä»½

**ä»£ç ç¤ºä¾‹ï¼š**

```typescript
// ç”Ÿæˆèº«ä»½æ‰¿è¯º
async function generateIdentityCommitment(
  email: string,
  sub: string,
  secret: bigint
): Promise<bigint> {
  // 1. è®¡ç®— Email Hash
  const emailHash = await hashEmailBytes(emailBytes);
  
  // 2. è®¡ç®— Identity Commitment
  // commitment = Poseidon(emailHash, sub, secret)
  const commitment = poseidon([emailHash, subNum, secret]);
  return commitment;
}
```

**åœ¨ ZK è¯æ˜ä¸­çš„ä½œç”¨ï¼š**

```
å…¬å¼€è¾“å…¥ï¼ˆæ‰€æœ‰äººå¯è§ï¼‰:  Identity Commitment
ç§æœ‰è¾“å…¥ï¼ˆåªæœ‰è¯æ˜è€…çŸ¥é“ï¼‰: Email, Sub, Secret

è¯æ˜é€»è¾‘ï¼š
1. è¯æ˜è€…çŸ¥é“ Email, Sub, Secret
2. éªŒè¯ Poseidon(Email, Sub, Secret) == Identity Commitment
3. å¦‚æœç›¸ç­‰ï¼Œè¯æ˜æœ‰æ•ˆ
```

è¿™æ ·ï¼ŒéªŒè¯è€…å¯ä»¥ç¡®è®¤"è¿™ä¸ªäººç¡®å®æ‹¥æœ‰å¯¹åº”çš„ Google èº«ä»½"ï¼Œä½†å®Œå…¨ä¸çŸ¥é“è¿™ä¸ªèº«ä»½æ˜¯ä»€ä¹ˆã€‚

### æ­¥éª¤ 4: ä¼šè¯æˆæƒï¼ˆSession Authorizationï¼‰

```
Session Auth = Poseidon(Identity Commitment, Session Public Key)
```

**ä½œç”¨ï¼š**
- å°†ç”¨æˆ·èº«ä»½ä¸ä¸´æ—¶ä¼šè¯å¯†é’¥ç»‘å®š
- è¯æ˜è¿™ä¸ªä¼šè¯å¯†é’¥å±äºç‰¹å®šçš„èº«ä»½
- ä¼šè¯å¯†é’¥ 24 å°æ—¶åè¿‡æœŸï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ

### æ­¥éª¤ 5: ZK è¯æ˜ç”Ÿæˆ

**å…¬å¼€è¾“å…¥ï¼ˆPublic Inputsï¼‰** - æ‰€æœ‰äººå¯è§ï¼š
- `identityCommitment`: èº«ä»½æ‰¿è¯º
- `sessionPublicKey`: ä¼šè¯å…¬é’¥

**ç§æœ‰è¾“å…¥ï¼ˆPrivate Inputsï¼‰** - åªæœ‰è¯æ˜è€…çŸ¥é“ï¼š
- `email`: ç”¨æˆ·é‚®ç®±
- `sub`: Google ç”¨æˆ· ID
- `secret`: ä» JWT æ´¾ç”Ÿçš„ç§˜å¯†

**ç”µè·¯éªŒè¯é€»è¾‘ï¼š**
```
1. éªŒè¯ Email Hash æ˜¯ä» email æ­£ç¡®è®¡ç®—çš„
2. éªŒè¯ Identity Commitment = Poseidon(Email Hash, sub, secret)
3. éªŒè¯ Identity Commitment ä¸å…¬å¼€è¾“å…¥åŒ¹é…
4. å¦‚æœæ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œè¾“å‡º valid = 1
```

**ä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿ**
- éªŒè¯è€…å¯ä»¥çœ‹åˆ° Identity Commitmentï¼Œä½†æ— æ³•çŸ¥é“ emailã€sub æˆ– secret
- è¯æ˜è€…å¿…é¡»çŸ¥é“æ­£ç¡®çš„ secret æ‰èƒ½ç”Ÿæˆæœ‰æ•ˆè¯æ˜
- è¯æ˜æ— æ³•ä¼ªé€ ï¼Œå› ä¸ºéœ€è¦å®é™…çš„ JWT æ¥æ´¾ç”Ÿ secret

## ğŸ§® æŠ€æœ¯å®ç°

### å“ˆå¸Œå‡½æ•°ï¼šPoseidon

**ä¸ºä»€ä¹ˆé€‰æ‹© Poseidonï¼Ÿ**
- ä¸“ä¸º ZK ç”µè·¯è®¾è®¡ï¼Œè®¡ç®—æ•ˆç‡é«˜
- åœ¨æœ‰é™åŸŸä¸Šè¿ç®—ï¼Œé€‚åˆç”µè·¯çº¦æŸ
- æ¯” SHA-256 åœ¨ç”µè·¯ä¸­æ›´è½»é‡

**ä½¿ç”¨æ–¹å¼ï¼š**
```typescript
// è®¡ç®— Poseidon å“ˆå¸Œ
const hash = poseidon([input1, input2, input3]);
```

### ZK è¯æ˜ç³»ç»Ÿï¼šGroth16

**ä»€ä¹ˆæ˜¯ Groth16ï¼Ÿ**
- ä¸€ç§é«˜æ•ˆçš„ ZK è¯æ˜ç³»ç»Ÿ
- è¯æ˜å¤§å°å°ï¼ˆçº¦ 200 å­—èŠ‚ï¼‰
- éªŒè¯é€Ÿåº¦å¿«

**è¯æ˜ç”Ÿæˆæµç¨‹ï¼š**
```
ç§æœ‰è¾“å…¥ + å…¬å¼€è¾“å…¥ â†’ ZK ç”µè·¯ â†’ è¯æ˜ (Proof)
```

**éªŒè¯æµç¨‹ï¼š**
```
è¯æ˜ + å…¬å¼€è¾“å…¥ + éªŒè¯å¯†é’¥ â†’ éªŒè¯ â†’ æœ‰æ•ˆ/æ— æ•ˆ
```

### Circom ç”µè·¯

**SimpleAuth ç”µè·¯ç»“æ„ï¼š**
```circom
template SimpleAuth(emailLength) {
    // å…¬å¼€è¾“å…¥
    signal input identityCommitment;
    signal input sessionPublicKey;
    
    // ç§æœ‰è¾“å…¥
    signal input email[emailLength];
    signal input sub;
    signal input secret;
    
    // è¾“å‡º
    signal output valid;
    
    // 1. è®¡ç®— Email Hashï¼ˆé“¾å¼å“ˆå¸Œï¼‰
    // 2. è®¡ç®— Identity Commitment
    // 3. éªŒè¯ Identity Commitment åŒ¹é…
    // 4. è¾“å‡º valid = 1 å¦‚æœéªŒè¯é€šè¿‡
}
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
sumo-login/
â”œâ”€â”€ circuits/                 # ZK ç”µè·¯
â”‚   â”œâ”€â”€ simple_auth.circom   # ä¸»è¦è®¤è¯ç”µè·¯
â”‚   â””â”€â”€ jwt_verify.circom    # JWT éªŒè¯ç”µè·¯
â”œâ”€â”€ public/zk/               # ç¼–è¯‘åçš„ç”µè·¯æ–‡ä»¶
â”‚   â”œâ”€â”€ simple_auth.wasm     # ç”µè·¯ WASM
â”‚   â”œâ”€â”€ simple_auth_final.zkey  # è¯æ˜å¯†é’¥
â”‚   â””â”€â”€ verification_key.json   # éªŒè¯å¯†é’¥
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ZKProofGenerator.tsx  # ZK è¯æ˜ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ AccountCard.tsx       # è´¦æˆ·ä¿¡æ¯å¡ç‰‡
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ zkProofService.ts    # ZK è¯æ˜æœåŠ¡
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ crypto.ts            # åŠ å¯†å·¥å…·å‡½æ•°
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### ç¼–è¯‘ç”µè·¯ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¿®æ”¹äº† `.circom` æ–‡ä»¶ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ï¼š

```bash
cd circuits
./compile.sh
```

### è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
```

## ğŸ” ä»£ç é€»è¾‘è¯¦è§£

### 1. ç™»å½•æµç¨‹ ([`src/App.tsx`](src/App.tsx:1))

```typescript
// ç™»å½•æµç¨‹çŠ¶æ€æœº
type LoginStep = 'idle' | 'oauth' | 'jwt' | 'session' | 'zkproof' | 'account' | 'complete';

// æµç¨‹ï¼š
// 1. idle: ç­‰å¾…ç”¨æˆ·ç‚¹å‡»ç™»å½•
// 2. oauth: Google OAuth è®¤è¯
// 3. jwt: è·å–å¹¶è§£æ JWT
// 4. session: ç”Ÿæˆä¼šè¯å¯†é’¥å¯¹
// 5. zkproof: ç”Ÿæˆ ZK è¯æ˜
// 6. account: åˆ›å»ºæ™ºèƒ½è´¦æˆ·
// 7. complete: ç™»å½•å®Œæˆ
```

### 2. ZK è¯æ˜æœåŠ¡ ([`src/services/zkProofService.ts`](src/services/zkProofService.ts:1))

```typescript
// æ ¸å¿ƒå‡½æ•°

// ç”Ÿæˆèº«ä»½æ‰¿è¯º
async function generateIdentityCommitment(
  email: string,
  sub: string,
  secret: bigint
): Promise<bigint> {
  // 1. è®¡ç®— Email Hashï¼ˆé“¾å¼ Poseidonï¼‰
  const emailHash = await hashEmailBytes(emailBytes);
  
  // 2. è®¡ç®— Identity Commitment
  const commitment = poseidon([emailHash, subNum, secret]);
  return commitment;
}

// ç”Ÿæˆ ZK è¯æ˜
async function generateRealZKProof(
  jwt: GoogleJWT,
  sessionKey: SessionKeyPair,
  jwtToken: string
): Promise<ZKProof> {
  // 1. å‡†å¤‡è¾“å…¥
  const { publicInputs, privateInputs } = await generateProofInputs(...);
  
  // 2. ä½¿ç”¨ snarkjs ç”Ÿæˆè¯æ˜
  const fullProof = await groth16.fullProve(
    { ...privateInputs, ...publicInputs },
    CIRCUIT_WASM_URL,
    CIRCUIT_ZKEY_URL
  );
  
  return fullProof;
}
```

### 3. Email å“ˆå¸Œå®ç°

**TypeScript ç«¯ï¼š**
```typescript
async function hashEmailBytes(emailBytes: number[]): Promise<bigint> {
  const CHUNK_SIZE = 15;
  const POSEIDON_SIZE = 16;
  const numChunks = Math.ceil(emailBytes.length / CHUNK_SIZE);
  
  let currentHash: bigint = BigInt(0);
  
  for (let i = 0; i < numChunks; i++) {
    // æ„å»ºè¾“å…¥ï¼š[é“¾å¼è¾“å…¥, æ•°æ®...]
    const inputs = new Array(POSEIDON_SIZE).fill(0);
    inputs[0] = currentHash;
    
    // å¡«å……æ•°æ®
    for (let j = 0; j < chunk.length; j++) {
      inputs[j + 1] = chunk[j];
    }
    
    const hash = poseidon(inputs);
    currentHash = poseidon.F.toObject(hash);
  }
  
  return currentHash;
}
```

**Circom ç”µè·¯ç«¯ï¼š**
```circom
// ä¸ TypeScript å®Œå…¨ç›¸åŒçš„é€»è¾‘
var chunkSize = 15;
var numChunks = (emailLength + chunkSize - 1) \ chunkSize;

for (var i = 0; i < numChunks; i++) {
    chunkHasher[i] = Poseidon(16);
    
    // é“¾å¼è¾“å…¥
    if (i == 0) {
        chunkHasher[i].inputs[0] <== 0;
    } else {
        chunkHasher[i].inputs[0] <== intermediateHashes[i-1];
    }
    
    // æ•°æ®è¾“å…¥
    for (var j = 0; j < 15; j++) {
        chunkHasher[i].inputs[j + 1] <== email[start + j];
    }
}
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

1. **é›¶çŸ¥è¯†æ€§**ï¼šè¯æ˜è€…ä¸æš´éœ² JWTã€é‚®ç®±æˆ–ç§˜å¯†
2. **ä¸å¯ä¼ªé€ æ€§**ï¼šå¿…é¡»æ‹¥æœ‰æœ‰æ•ˆ JWT æ‰èƒ½ç”Ÿæˆæœ‰æ•ˆè¯æ˜
3. **æ—¶æ•ˆæ€§**ï¼šä¼šè¯å¯†é’¥ 24 å°æ—¶è¿‡æœŸ
4. **ç»‘å®šæ€§**ï¼šè¯æ˜ä¸ç‰¹å®šä¼šè¯å¯†é’¥ç»‘å®š

## ğŸ¤” å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆéœ€è¦ ZK è¯æ˜ï¼Ÿ
**A**: ä¼ ç»Ÿç™»å½•æ–¹å¼éœ€è¦æœåŠ¡å™¨éªŒè¯ JWTï¼ŒæœåŠ¡å™¨å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€‚ZK è¯æ˜å…è®¸ç”¨æˆ·è¯æ˜è‡ªå·±æ‹¥æœ‰æœ‰æ•ˆèº«ä»½ï¼Œè€Œæ— éœ€æš´éœ²ä»»ä½•æ•æ„Ÿä¿¡æ¯ã€‚

### Q: ZK è¯æ˜ä¼šè¢«é‡æ”¾æ”»å‡»å—ï¼Ÿ
**A**: ä¸ä¼šã€‚æ¯ä¸ªè¯æ˜éƒ½ä¸ç‰¹å®šçš„ä¼šè¯å¯†é’¥ç»‘å®šï¼Œä¸”åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚

### Q: å¦‚æœ JWT è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ
**A**: ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•è·å–æ–°çš„ JWTï¼Œç„¶åç”Ÿæˆæ–°çš„ ZK è¯æ˜ã€‚

### Q: ç”µè·¯æ–‡ä»¶ï¼ˆ.wasm, .zkeyï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ
**A**: 
- `.wasm`: ç¼–è¯‘åçš„ç”µè·¯ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­ç”Ÿæˆè¯æ˜
- `.zkey`: è¯æ˜å¯†é’¥ï¼ŒåŒ…å«ç”Ÿæˆè¯æ˜æ‰€éœ€çš„å‚æ•°
- `verification_key.json`: éªŒè¯å¯†é’¥ï¼Œç”¨äºéªŒè¯è¯æ˜

## ğŸ“š ç›¸å…³æŠ€æœ¯

- **Circom**: ZK ç”µè·¯è®¾è®¡è¯­è¨€
- **snarkjs**: JavaScript ZK è¯æ˜åº“
- **Poseidon**: ZK å‹å¥½çš„å“ˆå¸Œå‡½æ•°
- **Groth16**: é«˜æ•ˆçš„ ZK è¯æ˜ç³»ç»Ÿ
- **BN128**: æ¤­åœ†æ›²çº¿ï¼Œç”¨äºå¯†ç å­¦è¿ç®—
- **Garaga**: å°† Groth16 è¯æ˜è½¬æ¢ä¸º Starknet å¯éªŒè¯æ ¼å¼çš„å·¥å…·

### ä»€ä¹ˆæ˜¯ Garaga Proofï¼Ÿ

**Garaga** æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œç”¨äºå°† Ethereum ä¸Šçš„ Groth16 ZK è¯æ˜è½¬æ¢ä¸º Starknet å¯ä»¥éªŒè¯çš„æ ¼å¼ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦ Garagaï¼Ÿ

1. **ä¸åŒé“¾çš„å¯†ç å­¦åŸºç¡€ä¸åŒ**ï¼š
   - Ethereum ä½¿ç”¨ BN128 æ¤­åœ†æ›²çº¿
   - Starknet ä½¿ç”¨ STARK å‹å¥½çš„æœ‰é™åŸŸ

2. **è¯æ˜æ ¼å¼ä¸å…¼å®¹**ï¼š
   - snarkjs ç”Ÿæˆçš„è¯æ˜åŸºäº BN128
   - Starknet éœ€è¦ felt252 æ ¼å¼çš„è¯æ˜

3. **Garaga çš„ä½œç”¨**ï¼š
   - å°† BN128 æ›²çº¿ä¸Šçš„ç‚¹è½¬æ¢ä¸º Starknet çš„ felt252 æ ¼å¼
   - ç”Ÿæˆå¯åœ¨ Cairo åˆçº¦ä¸­éªŒè¯çš„è¯æ˜

#### Garaga Proof çš„ç»“æ„

```cairo
// Garaga è½¬æ¢åçš„è¯æ˜æ ¼å¼
struct GaragaProof {
    // è¯æ˜å…ƒç´  (felt252 æ•°ç»„)
    proof: Array<felt252>,
    
    // å…¬å…±è¾“å…¥
    public_inputs: Array<felt252>,
}
```

#### å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  snarkjs è¯æ˜   â”‚â”€â”€â”€â”€â–¶â”‚   Garaga    â”‚â”€â”€â”€â”€â–¶â”‚ Starknet å¯éªŒè¯ â”‚
â”‚  (BN128 æ ¼å¼)   â”‚     â”‚   è½¬æ¢å™¨     â”‚     â”‚  (felt252 æ ¼å¼) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤ï¼š
1. ä½¿ç”¨ snarkjs ç”Ÿæˆ Groth16 è¯æ˜ï¼ˆåŸºäº BN128 æ›²çº¿ï¼‰
2. Garaga å°†è¯æ˜å…ƒç´ ä» BN128 åæ ‡è½¬æ¢ä¸º felt252
3. è½¬æ¢åçš„è¯æ˜å¯ä»¥åœ¨ Cairo åˆçº¦ä¸­éªŒè¯
```

#### åœ¨ SUMO ä¸­çš„ä½¿ç”¨

```typescript
// 1. ç”Ÿæˆ snarkjs è¯æ˜
const snarkjsProof = await groth16.fullProve(inputs, wasm, zkey);

// 2. è½¬æ¢ä¸º Garaga æ ¼å¼ï¼ˆfelt252 æ•°ç»„ï¼‰
const garagaProof: bigint[] = convertToGaragaFormat(snarkjsProof);

// 3. æäº¤åˆ° Starknet
await deploySumoAccount(jwt, jwtToken, sessionKey, maxBlock, garagaProof);
```

#### è½¬æ¢ç»†èŠ‚

Garaga ä¸»è¦è¿›è¡Œä»¥ä¸‹è½¬æ¢ï¼š
- **G1 ç‚¹**: (x, y) ä» BN128 åæ ‡ â†’ felt252
- **G2 ç‚¹**: (x1, x2, y1, y2) ä» BN128 åæ ‡ â†’ felt252 æ•°ç»„
- **å…¬å…±è¾“å…¥**: ä»å­—ç¬¦ä¸²/æ•°å­—è½¬æ¢ä¸º felt252

## ğŸ“ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³é“¾æ¥

- [Garaga GitHub](https://github.com/keep-starknet-strange/garaga)
- [SUMO Login Cairo åˆçº¦](https://github.com/haipome/sumo-login-cairo)
- [Starknet æ–‡æ¡£](https://docs.starknet.io/)
- [Circom æ–‡æ¡£](https://docs.circom.io/)

MIT License
